(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"ct+p":function(e,t,n){"use strict";n.r(t),n.d(t,"HomePageModule",(function(){return m}));var o=n("ofXK"),r=n("TEn/"),i=n("3Pt+"),l=n("tyNb"),s=n("fXoL");function a(e,t){if(1&e){const e=s.Nb();s.Mb(0,"div"),s.Mb(1,"ion-button",10),s.Ub("click",(function(){return s.cc(e),s.Wb().onClickCall()})),s.hc(2," Call "),s.Lb(),s.Lb()}}function c(e,t){if(1&e){const e=s.Nb();s.Mb(0,"ion-button",11),s.Ub("click",(function(){return s.cc(e),s.Wb().onClickHangUp()})),s.hc(1," HangUp "),s.Lb()}}const h=[{path:"",component:(()=>{class e{constructor(e,t,n){this.renderer=e,this.elementRef=t,this.platform=n,this.ua=null,this.connectedSession=null,this.currentCall=null,this.localStream=null,this.remoteStream=null,this.setCallListeners=()=>{this.currentCall.on("localStreamAvailable",e=>{console.log("localStreamAvailable",e),this.localStream=e,e.addInDiv("local-stream","local-media",{height:"150px"},!1)}).on("streamAdded",e=>{console.log("streamAdded :",e),this.remoteStream=e,e.addInDiv("remote-stream","remote-media",{height:"150px"},!1)}).on("streamRemoved",e=>{e.removeFromDiv("remote-stream","remote-media"),this.remoteStream=null}).on("userMediaError",e=>{console.error("userMediaError detected : ",e),console.error("userMediaError detected with error : ",e.error)}).on("hangup",()=>{this.clearStreams(),this.currentCall=null,this.onCall=!1})},this.onClickCall=()=>{if(!this.opponentId)return void console.warn("Opponent number is null");if(this.onCall)return void console.warn("Call is already started");let e=this.connectedSession.getOrCreateContact(this.opponentId).call();e?(this.currentCall=e,this.setCallListeners(),this.onCall=!0):console.warn("Cannot establish the call")},this.onClickHangUp=()=>{this.clearStreams(),this.currentCall.hangUp(),this.currentCall=null,this.onCall=!1},this.checkPermissions=()=>{cordova.plugins.diagnostic.requestRuntimePermissions(e=>{console.log("Permissions statuses: ",e)},e=>{console.error("The following error occurred: ",e)},[cordova.plugins.diagnostic.permission.CAMERA,cordova.plugins.diagnostic.permission.RECORD_AUDIO])},this.clearStreams=()=>{this.localStream&&this.localStream.removeFromDiv("local-stream","local-media"),this.remoteStream&&this.remoteStream.removeFromDiv("remote-stream","remote-media"),this.localStream=null,this.remoteStream=null},this.onCall=!1,this.infoLabel="Initializing...",this.platform.ready().then(()=>{this.platform.is("ios")&&cordova.plugins.iosrtc.registerGlobals();const e=this.renderer.createElement("script");e.src="https://cloud.apizee.com/apiRTC/apiRTC-latest.min.js",e.onload=()=>{console.log("apiRTC loaded"),this.startApp()},this.renderer.appendChild(this.elementRef.nativeElement,e)})}startApp(){console.log("startApp"),apiRTC.setLogLevel(10),this.ua=new apiRTC.UserAgent({uri:"apzkey:myDemoApiKey"}),this.ua.register({cloudUrl:"https://cloud.apizee.com"}).then(e=>{console.log("User registered with session: ",e),e.on("contactListUpdate",e=>{console.log("contactListUpdate",e)}).on("incomingCall",e=>{e.accept().then(e=>{this.currentCall=e,this.setCallListeners(),this.onCall=!0})}),this.connectedSession=e,this.infoLabel="Your id: "+e.getId()}).catch((function(e){console.error("User agent registration failed",e)})),this.checkPermissions()}}return e.\u0275fac=function(t){return new(t||e)(s.Jb(s.D),s.Jb(s.l),s.Jb(r.n))},e.\u0275cmp=s.Db({type:e,selectors:[["app-home"]],decls:18,vars:6,consts:[[3,"translucent"],[2,"height","15px"],[3,"fullscreen"],["color","primary"],[2,"height","80px","padding","20px 0"],["placeholder","Enter number",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["hangupButton",""],["id","local-stream"],["id","remote-stream"],["color","primary",3,"click"],["color","danger",3,"click"]],template:function(e,t){if(1&e&&(s.Mb(0,"ion-header",0),s.Mb(1,"ion-toolbar"),s.Mb(2,"ion-title"),s.hc(3," P2P call sample "),s.Lb(),s.Lb(),s.Lb(),s.Kb(4,"ion-row",1),s.Mb(5,"ion-content",2),s.Mb(6,"ion-grid"),s.Mb(7,"ion-row"),s.Mb(8,"ion-label",3),s.hc(9),s.Lb(),s.Lb(),s.Mb(10,"ion-row",4),s.Mb(11,"ion-input",5),s.Ub("ngModelChange",(function(e){return t.opponentId=e})),s.Lb(),s.Lb(),s.Mb(12,"ion-row"),s.fc(13,a,3,0,"div",6),s.fc(14,c,2,0,"ng-template",null,7,s.gc),s.Lb(),s.Kb(16,"ion-row",8),s.Kb(17,"ion-row",9),s.Lb(),s.Lb()),2&e){const e=s.bc(15);s.Zb("translucent",!0),s.zb(5),s.Zb("fullscreen",!0),s.zb(4),s.ic(" ",t.infoLabel," "),s.zb(2),s.Zb("ngModel",t.opponentId),s.zb(2),s.Zb("ngIf",!t.onCall)("ngIfElse",e)}},directives:[r.e,r.k,r.j,r.i,r.c,r.d,r.g,r.f,r.o,i.d,i.e,o.h,r.b],styles:["#container[_ngcontent-%COMP%]{text-align:center;background:red;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}ion-input[_ngcontent-%COMP%]{border:1px solid #3880ff}"]}),e})()}];let d=(()=>{class e{}return e.\u0275mod=s.Hb({type:e}),e.\u0275inj=s.Gb({factory:function(t){return new(t||e)},imports:[[l.i.forChild(h)],l.i]}),e})(),m=(()=>{class e{}return e.\u0275mod=s.Hb({type:e}),e.\u0275inj=s.Gb({factory:function(t){return new(t||e)},imports:[[o.b,i.a,r.l,d]]}),e})()}}]);